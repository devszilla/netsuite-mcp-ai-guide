<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NetSuite MCP AI Assistant - Complete Setup Guide</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
      }

      .header h1 {
        font-size: 3rem;
        color: #2c3e50;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header .subtitle {
        font-size: 1.2rem;
        color: #7f8c8d;
        max-width: 600px;
        margin: 0 auto;
      }

      .content {
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        margin-bottom: 30px;
      }

      h2 {
        font-size: 2.2rem;
        color: #2c3e50;
        margin: 40px 0 20px 0;
        padding-bottom: 10px;
        border-bottom: 3px solid #3498db;
        position: relative;
      }

      h2::before {
        content: "";
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #3498db, #9b59b6);
      }

      h3 {
        font-size: 1.8rem;
        color: #34495e;
        margin: 30px 0 15px 0;
        padding-left: 15px;
        border-left: 4px solid #3498db;
      }

      h4 {
        font-size: 1.4rem;
        color: #2c3e50;
        margin: 25px 0 15px 0;
      }

      p {
        margin-bottom: 20px;
        font-size: 1.1rem;
        color: #555;
      }

      ul,
      ol {
        margin: 20px 0;
        padding-left: 30px;
      }

      li {
        margin-bottom: 10px;
        font-size: 1.1rem;
        color: #555;
      }

      .highlight-box {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        margin: 25px 0;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .highlight-box h4 {
        color: white;
        margin-bottom: 15px;
        border-left: none;
        padding-left: 0;
      }

      .highlight-box ol {
        list-style: none;
        padding-left: 0;
        text-align: center;
        counter-reset: item;
      }

      .highlight-box ul {
        list-style: disc;
        padding-left: 30px;
        text-align: left;
      }

      .highlight-box li {
        color: white;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .highlight-box ol li {
        position: relative;
        padding-left: 30px;
      }

      .highlight-box ol li::before {
        content: counter(item) ".";
        counter-increment: item;
        color: white;
        font-weight: bold;
        position: absolute;
        left: 0;
        min-width: 20px;
        text-align: center;
      }

      .code-block {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 25px;
        border-radius: 15px;
        margin: 25px 0;
        overflow-x: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        position: relative;
      }

      .code-block::before {
        content: "💻";
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
      }

      .code-block code {
        font-family: "Courier New", monospace;
        font-size: 0.95rem;
        line-height: 1.5;
      }

      .code-block pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .bash {
        background: #1e1e1e;
      }

      .javascript {
        background: #2d3748;
      }

      .env {
        background: #2d3748;
      }

      .json {
        background: #2d3748;
      }

      .warning {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        border-left: 5px solid #e67e22;
        padding: 20px;
        border-radius: 10px;
        margin: 25px 0;
      }

      .warning h4 {
        color: #d35400;
        border-left: none;
        padding-left: 0;
      }

      .success {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        border-left: 5px solid #27ae60;
        padding: 20px;
        border-radius: 10px;
        margin: 25px 0;
      }

      .success h4 {
        color: #27ae60;
        border-left: none;
        padding-left: 0;
      }

      .step-number {
        display: inline-block;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        text-align: center;
        line-height: 30px;
        margin-right: 15px;
        font-weight: bold;
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin: 30px 0;
      }

      .feature-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .feature-card h4 {
        color: white;
        margin-bottom: 15px;
        border-left: none;
        padding-left: 0;
      }

      .toc {
        background: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .toc h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        border-left: none;
        padding-left: 0;
      }

      .toc ul {
        list-style: none;
        padding-left: 0;
      }

      .toc li {
        margin-bottom: 10px;
      }

      .toc a {
        color: #3498db;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .toc a:hover {
        color: #9b59b6;
      }

      .prerequisites {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        padding: 25px;
        border-radius: 15px;
        margin: 30px 0;
      }

      .prerequisites h3 {
        color: #d35400;
        border-left: none;
        padding-left: 0;
      }

      .conclusion {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        padding: 30px;
        border-radius: 15px;
        margin: 30px 0;
        text-align: center;
      }

      .conclusion h3 {
        color: #27ae60;
        border-left: none;
        padding-left: 0;
      }

      .flow-diagram {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 40px 0;
        flex-wrap: wrap;
        gap: 20px;
      }

      .flow-step {
        background: rgba(255, 255, 255, 0.9);
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 200px;
        position: relative;
      }

      .step-icon {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .flow-arrow {
        font-size: 2rem;
        color: #3498db;
        font-weight: bold;
        margin: 0 10px;
      }

      @media (max-width: 768px) {
        .flow-diagram {
          flex-direction: column;
        }

        .flow-arrow {
          transform: rotate(90deg);
          margin: 10px 0;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .content {
          padding: 25px;
        }

        h2 {
          font-size: 1.8rem;
        }

        h3 {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="content">
        <h1
          style="
            text-align: center;
            margin-bottom: 15px;
            font-size: 2.8rem;
            font-weight: 700;
            color: #2c3e50;
            letter-spacing: -0.5px;
          "
        >
          🚀 NetSuite MCP AI Integration
        </h1>

        <div style="text-align: center; margin-bottom: 25px">
          <span
            style="
              background: linear-gradient(135deg, #667eea, #764ba2);
              color: white;
              padding: 8px 20px;
              border-radius: 25px;
              font-size: 1rem;
              font-weight: 600;
              letter-spacing: 0.5px;
              text-transform: uppercase;
              margin-right: 15px;
            "
          >
            BYOAI - Bring Your Own AI
          </span>
          <span
            style="
              background: linear-gradient(135deg, #ffecd2, #fcb69f);
              color: #d35400;
              padding: 8px 20px;
              border-radius: 25px;
              font-size: 0.9rem;
              font-weight: 600;
              letter-spacing: 0.5px;
            "
          >
            📅 August 15, 2025
          </span>
        </div>

        <p
          style="
            text-align: center;
            font-size: 1.4rem;
            color: #34495e;
            margin-bottom: 20px;
            font-weight: 500;
            letter-spacing: 0.2px;
          "
        >
          Architecture & Key Components Guide
        </p>

        <div
          style="
            text-align: center;
            margin-bottom: 25px;
            padding: 15px 0;
            border-top: 1px solid #ecf0f1;
            border-bottom: 1px solid #ecf0f1;
          "
        >
          <p
            style="
              margin: 0;
              font-size: 1.1rem;
              color: #7f8c8d;
              font-weight: 500;
            "
          >
            by: Caleb Moore, Certified NetSuite SuiteCloud Developer
          </p>
        </div>

        <div
          style="
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border-left: 4px solid #e67e22;
            padding: 20px;
            border-radius: 10px;
            max-width: 700px;
            margin: 0 auto 40px auto;
          "
        >
          <p
            style="
              margin: 0 0 15px 0;
              font-size: 1.1rem;
              color: #d35400;
              font-weight: 600;
              line-height: 1.5;
            "
          >
            Understanding how to connect your AI assistant to NetSuite using
            Model Context Protocol (MCP)
          </p>
          <p
            style="
              margin: 0;
              font-size: 0.95rem;
              color: #d35400;
              font-weight: 500;
              line-height: 1.5;
            "
          >
            ⚠️ <strong>Rapidly Evolving Technology:</strong> This document
            reflects the current state of NetSuite MCP and AI integration as of
            the date above. Given the fast-paced nature of AI technology and
            NetSuite updates, portions of this guide may become outdated
            quickly. Always verify current NetSuite documentation and AI service
            capabilities.
          </p>
        </div>

        <div class="highlight-box">
          <h4>🎯 What This Guide Provides</h4>
          <p>
            This is a <strong>conceptual guide</strong> that explains the key
            components and architecture needed to connect your AI assistant to
            NetSuite MCP. It's not a copy/paste tutorial, but rather helps you
            understand what you need to build and how the pieces fit together.
          </p>
        </div>

        <div class="highlight-box">
          <h4>🔧 Technology Implementation Note</h4>
          <p>
            <strong>This concept was proven using:</strong> Google Gemini AI +
            React-based chatbot interface
          </p>
          <p>
            <strong
              >However, there are many ways to leverage NetSuite's AI
              Connector:</strong
            >
            You could use Claude, GPT-4, Azure OpenAI, or any other AI service.
            The architecture principles remain the same regardless of your AI
            choice.
          </p>
          <p>
            <strong>Current State:</strong> While this integration concept has
            been proven to work, it isn't perfect and would still benefit from
            further refinement. Expect some bugs and edge cases that need
            addressing.
          </p>
        </div>

        <div class="toc">
          <h3>📋 Table of Contents</h3>
          <ul>
            <li><a href="#overview">Overview & Architecture</a></li>
            <li><a href="#part1">Part 1: NetSuite MCP Setup</a></li>
            <li><a href="#part2">Part 2: Core Components</a></li>
            <li><a href="#part3">Part 3: AI Integration</a></li>
            <li><a href="#part4">Part 4: Frontend React Application</a></li>
            <li><a href="#part5">Part 5: Development & Testing</a></li>
            <li><a href="#part6">Part 6: Getting Started</a></li>
            <li><a href="#part7">Part 7: Troubleshooting</a></li>
            <li><a href="#part8">Part 8: Production Considerations</a></li>
          </ul>
        </div>
      </div>

      <div class="content">
        <h2 id="overview">Overview</h2>
        <p>
          This guide explains the architecture and key components needed to
          connect your AI assistant to NetSuite using Model Context Protocol
          (MCP). The goal is to create a system where users can ask natural
          language questions and get real-time data from NetSuite without
          needing to know SuiteQL or navigate complex interfaces.
        </p>

        <div class="highlight-box">
          <h4>🎯 What You'll Understand</h4>
          <p>
            How to architect an AI-powered system that bridges natural language
            queries with NetSuite's MCP tools, enabling conversational data
            access to your business data.
          </p>
        </div>

        <h3>🔄 System Flow Overview</h3>
        <div class="flow-diagram">
          <div class="flow-step">
            <div class="step-icon">👤</div>
            <h4>User Question</h4>
            <p>"How many customers do we have?"</p>
          </div>
          <div class="flow-arrow">→</div>
          <div class="flow-step">
            <div class="step-icon">🧠</div>
            <h4>AI Analysis</h4>
            <p>Gemini determines: use runCustomSuiteQL with COUNT query</p>
          </div>
          <div class="flow-arrow">→</div>
          <div class="flow-step">
            <div class="step-icon">🔧</div>
            <h4>MCP Execution</h4>
            <p>NetSuite MCP tool runs: SELECT COUNT(*) FROM customer</p>
          </div>
          <div class="flow-arrow">→</div>
          <div class="flow-step">
            <div class="step-icon">💬</div>
            <h4>AI Interpretation</h4>
            <p>Gemini converts raw data to: "You have 4,214 customers"</p>
          </div>
        </div>

        <div class="feature-grid">
          <div class="feature-card">
            <h4>🧠 AI Query Analysis</h4>
            <p>
              Your AI analyzes user questions and selects the right MCP tool
              with proper parameters
            </p>
          </div>
          <div class="feature-card">
            <h4>🔧 MCP Tool Execution</h4>
            <p>
              Executes the selected tool against NetSuite and retrieves raw data
            </p>
          </div>
          <div class="feature-card">
            <h4>💬 AI Response Interpretation</h4>
            <p>
              Your AI interprets the NetSuite results and provides
              conversational answers
            </p>
          </div>
          <div class="feature-card">
            <h4>🛡️ Smart Fallbacks</h4>
            <p>Intelligent parsing when AI interpretation fails</p>
          </div>
        </div>
      </div>

      <div class="content">
        <h2 id="prerequisites">Prerequisites</h2>
        <div class="prerequisites">
          <h3>Before You Begin</h3>
          <p style="margin-bottom: 20px; font-style: italic; color: #7f8c8d">
            <strong>Note:</strong> The examples in this guide use Google Gemini
            AI + React + Node.js, but this architecture is flexible and can be
            adapted to your preferred AI service, frontend framework, or backend
            technology.
          </p>
          <ul>
            <li>
              <strong>NetSuite Account:</strong> Administrative access required
            </li>
            <li>
              <strong>AI Service:</strong> API key for your chosen AI provider
              (Gemini, Claude, GPT-4, Azure OpenAI, etc.)
            </li>
            <li>
              <strong>Development Environment:</strong> Your preferred frontend
              framework (React, Vue, Angular, etc.) and backend technology
              (Node.js, Python, .NET, etc.)
            </li>
            <li>
              <strong>Development Skills:</strong> Basic knowledge of your
              chosen technologies and REST API integration
            </li>
          </ul>
        </div>
      </div>

      <div class="content">
        <h2 id="part1">Part 1: NetSuite MCP Setup</h2>

        <p>
          Before you can connect your AI to NetSuite, you need to set up the MCP
          (Model Context Protocol) infrastructure on the NetSuite side. This
          involves installing the MCP Tools SuiteApp and configuring the
          necessary permissions.
        </p>

        <h3>1.1 Install MCP Tools SuiteApp</h3>
        <p>
          The MCP Tools SuiteApp provides the interface between your AI and
          NetSuite data. You'll need to:
        </p>
        <ul>
          <li>
            Navigate to
            <strong
              >Customization → SuiteCloud Development → SuiteApp
              Marketplace</strong
            >
          </li>
          <li>Search for and install <strong>MCP Tools</strong></li>
          <li>Wait for the installation to complete</li>
        </ul>

        <h3>1.2 Create Custom Role</h3>
        <div class="warning">
          <h4>⚠️ Important</h4>
          <p>
            Administrators are not allowed to work with MCP - you must create a
            custom role with specific permissions.
          </p>
        </div>
        <p>You'll need to create a custom role with these key permissions:</p>
        <ul>
          <li>
            <strong>MCP Server Connection</strong> - Allows connection to the
            MCP server
          </li>
          <li>
            <strong>OAuth 2.0 Authorized Applications Management</strong> -
            Manages OAuth integrations
          </li>
          <li>
            <strong>Log in using OAuth 2.0 Access Tokens</strong> - Enables
            token-based authentication
          </li>
        </ul>
        <p>
          This role will be assigned to the user account that your AI
          integration will use to connect to NetSuite.
        </p>

        <h3>1.3 Assign Role to User</h3>
        <p>
          Assign the custom MCP role to the user account that will be used for
          your AI integration. This user will authenticate with NetSuite on
          behalf of your AI system.
        </p>

        <h3>1.4 Create Integration Record</h3>
        <p>
          Create an OAuth 2.0 integration record that will allow your AI system
          to authenticate with NetSuite. Key configuration points:
        </p>
        <ul>
          <li><strong>Application Type:</strong> Public Client</li>
          <li><strong>State:</strong> Enabled</li>
          <li>
            <strong>Authorization Code Grant:</strong> Enabled for secure
            authentication
          </li>
          <li>
            <strong>Redirect URI:</strong> Your application's callback URL
          </li>
          <li>
            <strong>Scopes:</strong> Leave all unchecked - the
            <code>mcp</code> scope is handled in the OAuth authorization call,
            not in the NetSuite integration record
          </li>
        </ul>

        <div class="warning">
          <h4>⚠️ Important: Disable These Features</h4>
          <p>
            Make sure these features are <strong>disabled</strong> in your
            integration record:
          </p>
          <ul>
            <li><strong>Token-based Authentication</strong></li>
            <li><strong>TBA: issuetoken Endpoint</strong></li>
            <li><strong>TBA: Authorization Flow</strong></li>
          </ul>
        </div>

        <p>
          This integration record will provide you with a Client ID that your AI
          system will use during the OAuth flow.
        </p>
      </div>

      <div class="content">
        <h2 id="part2">Part 2: Core Components</h2>

        <p>
          Your AI integration system will need several core components to
          function properly. Here's what you'll need to build or integrate:
        </p>

        <h3>2.1 Backend Server</h3>
        <p>You'll need a backend server that handles:</p>
        <ul>
          <li>
            <strong>OAuth Flow:</strong> Manages authentication with NetSuite
          </li>
          <li>
            <strong>MCP Proxy:</strong> Forwards requests to NetSuite's MCP
            server
          </li>
          <li>
            <strong>Token Management:</strong> Handles access token refresh and
            storage
          </li>
          <li>
            <strong>Error Handling:</strong> Manages API failures and retries
          </li>
        </ul>

        <h3>2.2 Frontend Interface</h3>
        <p>Your user interface should provide:</p>
        <ul>
          <li>
            <strong>Configuration Panel:</strong> For NetSuite credentials and
            settings
          </li>
          <li><strong>Chat Interface:</strong> Where users ask questions</li>
          <li>
            <strong>Status Indicators:</strong> Show connection and tool
            availability
          </li>
          <li><strong>Response Display:</strong> Show AI-generated answers</li>
        </ul>

        <h3>2.3 AI Integration</h3>
        <p>The core intelligence layer includes:</p>
        <ul>
          <li>
            <strong>Query Analysis:</strong> AI that understands user questions
          </li>
          <li>
            <strong>Tool Selection:</strong> Maps questions to appropriate MCP
            tools
          </li>
          <li>
            <strong>Response Generation:</strong> Converts raw data to
            conversational answers
          </li>
          <li>
            <strong>Fallback Logic:</strong> Handles cases where AI
            interpretation fails
          </li>
        </ul>
      </div>

      <div class="content">
        <h2 id="part3">Part 3: AI Integration</h2>

        <p>
          This is where the magic happens! Your AI needs to understand user
          questions, select the right MCP tools, and interpret the results
          conversationally. Here's how the AI integration works:
        </p>

        <h3>3.1 AI Query Analysis</h3>
        <p>Your AI (Gemini in our case) needs to:</p>
        <ul>
          <li>
            <strong>Parse Natural Language:</strong> Understand what the user is
            asking
          </li>
          <li>
            <strong>Map to MCP Tools:</strong> Determine which NetSuite MCP tool
            to use
          </li>
          <li>
            <strong>Generate Parameters:</strong> Create the right parameters
            for the tool
          </li>
          <li>
            <strong>Assess Confidence:</strong> Determine if it's confident
            enough to proceed
          </li>
        </ul>

        <div class="highlight-box">
          <h4>💡 Example AI Analysis</h4>
          <p><strong>User:</strong> "How many customers do we have?"</p>
          <p>
            <strong>AI Analysis:</strong> Use <code>runCustomSuiteQL</code> with
            <code>SELECT COUNT(*) FROM customer</code>
          </p>
        </div>

        <h3>3.2 MCP Tool Execution</h3>
        <p>
          Once your AI determines the right tool and parameters, you need to:
        </p>
        <ul>
          <li>
            <strong>Authenticate:</strong> Use OAuth tokens to access NetSuite's
            MCP server
          </li>
          <li>
            <strong>Format Requests:</strong> Structure JSON-RPC calls to the
            MCP endpoint
          </li>
          <li>
            <strong>Handle Responses:</strong> Process the raw data returned
            from NetSuite
          </li>
          <li>
            <strong>Manage Errors:</strong> Handle authentication failures and
            API errors
          </li>
        </ul>

        <div class="highlight-box">
          <h4>🔧 MCP Request Format</h4>
          <p>
            Your requests to NetSuite's MCP server should follow the JSON-RPC
            2.0 specification:
          </p>
          <pre><code>{
  "jsonrpc": "2.0",
  "id": "unique_request_id",
  "method": "tools/call",
  "params": {
    "name": "toolName",
    "arguments": { ... }
  }
}</code></pre>
        </div>

        <h3>3.3 AI Response Interpretation</h3>
        <p>
          This is the key component that makes your AI conversational! Instead
          of returning raw JSON data, your AI needs to:
        </p>
        <ul>
          <li>
            <strong>Parse NetSuite Responses:</strong> Extract meaningful data
            from the MCP tool results
          </li>
          <li>
            <strong>Generate Natural Language:</strong> Convert technical data
            into conversational answers
          </li>
          <li>
            <strong>Handle Edge Cases:</strong> Deal with errors, missing data,
            or unexpected responses
          </li>
          <li>
            <strong>Provide Context:</strong> Give users relevant information
            based on their question
          </li>
        </ul>

        <div class="highlight-box">
          <h4>💬 Example Response Transformation</h4>
          <p>
            <strong>Raw NetSuite Response:</strong> <code>{"expr1": 4214}</code>
          </p>
          <p>
            <strong>AI Interpretation:</strong> "You have 4,214 customers in
            your system."
          </p>
        </div>

        <h3>3.4 MCP Tools Discovery Endpoint</h3>
        <div class="code-block javascript">
          <pre><code>app.post("/netsuite/mcp/tools", async (req, res) => {
  try {
    const accountId = req.headers["x-netsuite-account"];
    const authorization = req.headers.authorization;

    if (!authorization) {
      return res.status(401).json({
        error: "Missing Authorization header",
      });
    }

    const mcpUrl = `https://${accountId}.suitetalk.api.netsuite.com/services/mcp/v1/all`;

    const requestBody = {
      jsonrpc: "2.0",
      id: "2",
      method: "tools/list",
      params: {},
    };

    const response = await fetch(mcpUrl, {
      method: "POST",
      headers: {
        Authorization: authorization,
        "Content-Type": "application/json",
      },
      body: JSON.stringify(requestBody),
    });

    if (response.ok) {
      const data = await response.json();
      res.json({
        success: true,
        message: "MCP tools fetched successfully",
        status: response.status,
        data: data,
        url: mcpUrl,
      });
    } else {
      const errorText = await response.text();
      res.status(response.status).json({
        success: false,
        message: "MCP tools fetch failed",
        status: response.status,
        error: errorText,
        url: mcpUrl,
      });
    }
  } catch (error) {
    console.error("MCP tools endpoint error:", error);
    res.status(500).json({
      error: "MCP tools fetch failed",
      details: error.message,
    });
  }
});</code></pre>
        </div>

        <h3>3.5 MCP Tool Execution Endpoint</h3>
        <div class="code-block javascript">
          <pre><code>app.post("/netsuite/mcp/execute", async (req, res) => {
  try {
    const { jsonrpc, id, method, params } = req.body;
    const accountId = req.headers["x-netsuite-account"];
    const authorization = req.headers.authorization;

    if (!authorization) {
      return res.status(401).json({
        error: "Missing Authorization header",
      });
    }

    if (!jsonrpc || !id || !method) {
      return res.status(400).json({
        error: "Missing required parameters: jsonrpc, id, method",
      });
    }

    const mcpUrl = `https://${accountId}.suitetalk.api.netsuite.com/services/mcp/v1/all`;

    const requestBody = {
      jsonrpc,
      id,
      method,
      params: params || {},
    };

    const response = await fetch(mcpUrl, {
      method: "POST",
      headers: {
        Authorization: authorization,
        "Content-Type": "application/json",
      },
      body: JSON.stringify(requestBody),
    });

    if (response.ok) {
      const data = await response.json();

      if (data.error) {
        return res.status(400).json({
          success: false,
          message: "MCP tool execution failed",
          status: response.status,
          error: data.error,
          url: mcpUrl,
        });
      }

      res.json({
        success: true,
        message: "MCP tool executed successfully",
        status: response.status,
        data: data,
        url: mcpUrl,
      });
    } else {
      const errorText = await response.text();
      let errorDetails = errorText;

      try {
        const errorJson = JSON.parse(errorText);
        if (errorJson.error) {
          errorDetails = errorJson.error;
        }
      } catch (e) {
        // If not JSON, use the raw text
      }

      res.status(response.status).json({
        success: false,
        message: "MCP tool execution failed",
        status: response.status,
        error: errorDetails,
        url: mcpUrl,
      });
    }
  } catch (error) {
    console.error("MCP tool execution endpoint error:", error);
    res.status(500).json({
      error: "MCP tool execution failed",
      details: error.message,
    });
  }
});</code></pre>
        </div>

        <h3>3.6 Start Server</h3>
        <div class="code-block javascript">
          <pre><code>app.listen(PORT, () => {
  console.log(`Backend server running on port ${PORT}`);
  console.log(`CORS enabled for origin: http://localhost:3000`);
});</code></pre>
        </div>
      </div>

      <div class="content">
        <h2 id="part4">Part 4: Frontend React Application</h2>

        <h3>4.1 OAuth Utility Functions (src/utils/oauth.js)</h3>
        <div class="code-block javascript">
          <pre><code>// Generate PKCE code verifier
export function generateCodeVerifier() {
  const array = new Uint8Array(32);
  crypto.getRandomValues(array);
  return base64URLEncode(array);
}

// Generate PKCE code challenge
export async function generateCodeChallenge(codeVerifier) {
  const hash = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(codeVerifier)
  );
  return base64URLEncode(new Uint8Array(hash));
}

// Base64 URL encoding
function base64URLEncode(buffer) {
  return btoa(String.fromCharCode(...buffer))
    .replace(/\+/g, "-")
    .replace(/\//g, "_")
    .replace(/=/g, "");
}</code></pre>
        </div>

        <h3>4.2 Main App Component (src/App.js)</h3>
        <p>The main React component handles:</p>
        <ul>
          <li>OAuth flow with NetSuite</li>
          <li>MCP tool discovery and execution</li>
          <li>AI-powered query analysis and tool selection</li>
          <li>AI-powered response interpretation</li>
          <li>User interface for configuration and chat</li>
        </ul>

        <div class="feature-grid">
          <div class="feature-card">
            <h4>🔐 OAuth 2.0 PKCE Flow</h4>
            <p>
              Secure authentication with NetSuite using industry-standard OAuth
              2.0 with PKCE
            </p>
          </div>
          <div class="feature-card">
            <h4>🔍 MCP Tool Discovery</h4>
            <p>
              Automatically fetches available tools from NetSuite's MCP server
            </p>
          </div>
          <div class="feature-card">
            <h4>🤖 AI-Powered Responses</h4>
            <p>Uses Google Gemini to interpret NetSuite data naturally</p>
          </div>
          <div class="feature-card">
            <h4>🛡️ Smart Fallbacks</h4>
            <p>Handles errors gracefully with intelligent parsing</p>
          </div>
        </div>

        <h3>4.3 Key State Variables</h3>
        <div class="code-block javascript">
          <pre><code>const [netsuiteConfig, setNetsuiteConfig] = useState({
  accountId: "",
  consumerKey: "",
});

const [accessToken, setAccessToken] = useState(null);
const [refreshToken, setRefreshToken] = useState(null);
const [mcpTools, setMcpTools] = useState([]);</code></pre>
        </div>

        <h3>4.4 AI Query Analysis</h3>
        <p>
          Before executing any MCP tools, the AI analyzes the user's question to
          determine the right tool and parameters:
        </p>

        <div class="code-block javascript">
          <pre><code>const analyzeUserQuery = async (userInput) => {
  try {
    const genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);
    const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
    
    const analysisPrompt = `You are an AI assistant that helps users interact with NetSuite data through MCP tools.

Available MCP tools:
${mcpTools.map(tool => `- ${tool.name}: ${tool.description}`).join('\n')}

User question: "${userInput}"

Analyze this question and determine:
1. Which MCP tool should be used
2. What parameters to pass to the tool
3. Your confidence level (0-100)

Respond with JSON in this exact format:
{
  "confidence_score": 85,
  "action": "execute_tool",
  "tool_name": "runCustomSuiteQL",
  "tool_params": {
    "sqlQuery": "SELECT COUNT(*) FROM customer",
    "description": "Count all customers"
  },
  "reason": "User wants to count customers, so I'll use runCustomSuiteQL with a COUNT query"
}

If you're not confident or need clarification, use:
{
  "confidence_score": 45,
  "action": "ask_clarification",
  "reason": "The request is ambiguous. Please specify what type of customer information you need."
}`;

    const result = await model.generateContent(analysisPrompt);
    const response = await result.response;
    const responseText = response.text();
    
    // Extract JSON from the response
    const jsonMatch = responseText.match(/\{[\s\S]*\}/);
    if (jsonMatch) {
      return JSON.parse(jsonMatch[0]);
    }
    
    throw new Error("Failed to parse AI analysis response");
  } catch (error) {
    console.error("AI query analysis failed:", error);
    return {
      confidence_score: 0,
      action: "ask_clarification",
      reason: "I'm having trouble understanding your request. Please try rephrasing it."
    };
  }
};</code></pre>
        </div>

        <h3>4.6 OAuth Initialization</h3>
        <div class="code-block javascript">
          <pre><code>const initializeOAuth = async (e) => {
  if (e) {
    e.preventDefault();
    e.stopPropagation();
  }

  try {
    if (!netsuiteConfig.accountId || !netsuiteConfig.consumerKey) {
      throw new Error("Missing required credentials");
    }

    setIsInitializing(true);

    // Generate PKCE code verifier and challenge
    const codeVerifier = generateCodeVerifier();
    const codeChallenge = await generateCodeChallenge(codeVerifier);

    // Generate state parameter
    const state =
      Math.random().toString(36).substring(2) +
      Math.random().toString(36).substring(2) +
      Math.random().toString(36).substring(2) +
      Math.random().toString(36).substring(2);

    // Store PKCE code verifier and state
    localStorage.setItem("code_verifier", codeVerifier);
    localStorage.setItem("oauth_state", state);

    // Build authorization URL with MCP scope only
    const authUrl = `https://${
      netsuiteConfig.accountId
    }.app.netsuite.com/app/login/oauth2/authorize.nl?response_type=code&client_id=${
      netsuiteConfig.consumerKey
    }&redirect_uri=${encodeURIComponent(
      "http://localhost:3000"
    )}&scope=mcp&code_challenge=${codeChallenge}&code_challenge_method=S256&state=${state}`;

    // Redirect to NetSuite authorization
    window.location.href = authUrl;
  } catch (error) {
    console.error("OAuth initialization failed:", error);
    setIsInitializing(false);
    alert(`OAuth initialization failed: ${error.message}`);
  }
};</code></pre>
        </div>

        <h3>4.5 MCP Tool Execution</h3>
        <div class="code-block javascript">
          <pre><code>const executeMcpTool = async (toolName, params) => {
  try {
    let currentAccessToken = accessToken;

    if (!currentAccessToken) {
      currentAccessToken = localStorage.getItem("netsuite_access_token");
      if (currentAccessToken) {
        setAccessToken(currentAccessToken);
      }
    }

    if (!currentAccessToken) {
      throw new Error(
        "No access token available. Please authorize with NetSuite first."
      );
    }

    const response = await fetch("http://localhost:3001/netsuite/mcp/execute", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${currentAccessToken}`,
        "X-NetSuite-Account": netsuiteConfig.accountId,
      },
      body: JSON.stringify({
        jsonrpc: "2.0",
        id: Date.now().toString(),
        method: "tools/call",
        params: {
          name: toolName,
          arguments: params,
        },
      }),
    });

    if (response.status === 401) {
      // Token expired, try to refresh automatically
      try {
        const newToken = await refreshAccessToken();

        // Retry with new token
        const retryResponse = await fetch(
          "http://localhost:3001/netsuite/mcp/execute",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${newToken}`,
              "X-NetSuite-Account": netsuiteConfig.accountId,
            },
            body: JSON.stringify({
              jsonrpc: "2.0",
              id: Date.now().toString(),
              method: "tools/call",
              params: {
                name: toolName,
                arguments: params,
              },
            }),
          }
        );

        if (!retryResponse.ok) {
          const errorData = await retryResponse.json();
          throw new Error(
            `MCP tool execution error after token refresh: ${
              retryResponse.status
            } - ${errorData.error || "Unknown error"}`
          );
        }

        const result = await retryResponse.json();
        return result;
      } catch (refreshError) {
        throw new Error(
          `Authentication failed: ${refreshError.message}. Please re-authorize with NetSuite.`
        );
      }
    }

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(
        `MCP tool execution error: ${response.status} - ${
          errorData.error || "Unknown error"
        }`
      );
    }

    const result = await response.json();
    return result;
  } catch (error) {
    console.error("MCP tool execution error:", error);
    throw error;
  }
};</code></pre>
        </div>

        <h3>4.7 AI-Powered Response Interpretation</h3>
        <p>
          This is the key component that makes the bot intelligent and
          conversational. Instead of returning raw JSON data, the AI interprets
          NetSuite results and provides natural language answers.
        </p>

        <div class="code-block javascript">
          <pre><code>// AI interpretation prompt for Gemini
const interpretationPrompt = `You are a helpful NetSuite assistant. The user asked: "${inputText}"
I successfully retrieved data from NetSuite using the MCP tool "${toolName}". The tool executed successfully and returned data. Here is the complete response:
${JSON.stringify(toolResult, null, 2)}

CRITICAL: The MCP tool executed SUCCESSFULLY. Do NOT say there was an error or that the system doesn't recognize terms. The data IS available in this response.

Your task:
1. Look through this entire response structure to find the actual data
2. The data is likely nested in the response structure
3. Answer the user's original question based on the data you find
4. Give a natural, conversational answer

REQUIREMENTS:
- The tool executed successfully, so the data IS available
- Answer the question directly and briefly
- Don't mention technical details like "MCP tool", "NetSuite", or show raw data
- Don't explain HOW you found the information
- Just give the answer a human would give
- If it's a count, format numbers nicely (e.g., "4,214" not "4214")
- Keep it conversational and helpful

IMPORTANT: Look for success indicators like "status: 200" and "success: true" - these mean the data retrieval was successful.`;

// Use Gemini AI to interpret the results
const genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);
const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });

try {
  const result = await model.generateContent(interpretationPrompt);
  const response = await result.response;
  const responseText = response.text();
  
  // Clean up the response
  return responseText.replace(/^```\w*\n?|\n?```$/g, '').trim();
} catch (interpretationError) {
  console.error("AI interpretation failed:", interpretationError);
  
  // Fallback to intelligent parsing if AI fails
  return extractAnswerFromData(toolResult, inputText);
}</code></pre>
        </div>

        <h3>4.8 Fallback Data Extraction</h3>
        <p>
          When AI interpretation fails, you need intelligent fallback mechanisms
          to ensure users still get helpful responses. This is crucial for
          production reliability.
        </p>

        <div class="highlight-box">
          <h4>🛡️ Why Fallbacks Are Essential</h4>
          <p>AI interpretation can fail for many reasons:</p>
          <ul>
            <li>
              <strong>API Rate Limits:</strong> Gemini or other AI services may
              be temporarily unavailable
            </li>
            <li>
              <strong>Unexpected Data Formats:</strong> NetSuite responses might
              not match expected patterns
            </li>
            <li>
              <strong>Network Issues:</strong> Intermittent connectivity
              problems
            </li>
            <li>
              <strong>AI Model Limitations:</strong> Complex or ambiguous
              responses may confuse the AI
            </li>
          </ul>
        </div>

        <p><strong>Your fallback strategy should include:</strong></p>
        <ul>
          <li>
            <strong>Pattern Recognition:</strong> Use regex or string matching
            to identify common response types
          </li>
          <li>
            <strong>Data Extraction:</strong> Parse JSON responses to find key
            values (counts, balances, names, etc.)
          </li>
          <li>
            <strong>Graceful Degradation:</strong> Provide useful information
            even when full AI interpretation fails
          </li>
          <li>
            <strong>User Communication:</strong> Clearly indicate when fallback
            logic is being used
          </li>
        </ul>

        <div class="highlight-box">
          <h4>💡 Example Fallback Approach</h4>
          <p>
            Instead of hardcoding specific field names like <code>expr1</code>,
            design your fallback to:
          </p>
          <ul>
            <li>Look for numeric values that might represent counts</li>
            <li>Identify currency patterns for financial data</li>
            <li>Extract text fields that could be names or descriptions</li>
            <li>
              Provide generic but helpful responses when specific parsing fails
            </li>
          </ul>
        </div>

        <h3>4.9 Complete Message Handling Flow</h3>
        <p>Here's how the complete flow works when a user asks a question:</p>

        <div class="code-block javascript">
          <pre><code>const handleSendMessage = async (inputText) => {
  try {
    // 1. AI determines the right MCP tool and parameters
    const aiAnalysis = await analyzeUserQuery(inputText);
    
    if (aiAnalysis.action === 'execute_tool') {
      // 2. Execute the MCP tool against NetSuite
      const toolResult = await executeMcpTool(aiAnalysis.tool_name, aiAnalysis.tool_params);
      
      // 3. Use AI to interpret the results conversationally
      const responseText = await interpretNetSuiteResults(toolResult, inputText, aiAnalysis.tool_name);
      
      // 4. Add the response to the chat
      addMessage('bot', responseText);
    } else {
      // Handle clarification requests
      addMessage('bot', aiAnalysis.reason);
    }
  } catch (error) {
    console.error("Message handling failed:", error);
    addMessage('bot', `I encountered an error: ${error.message}`);
  }
};</code></pre>
        </div>
      </div>

      <div class="content">
        <h2 id="part5">Part 5: Development & Testing</h2>

        <div class="highlight-box">
          <h4>🔧 Implementation Approach</h4>
          <p>
            <strong>Remember:</strong> This guide shows one way to implement the
            NetSuite MCP integration. You can adapt these concepts to your
            preferred technology stack and development approach.
          </p>
        </div>

        <h3>5.1 Development Environment</h3>
        <p>You'll need to set up a development environment that supports:</p>
        <ul>
          <li>
            <strong>Backend Server:</strong> For OAuth handling and MCP proxy
            functionality
          </li>
          <li>
            <strong>Frontend Interface:</strong> For user interaction and
            configuration
          </li>
          <li>
            <strong>AI Integration:</strong> For query analysis and response
            interpretation
          </li>
          <li>
            <strong>Development Tools:</strong> For debugging and testing your
            integration
          </li>
        </ul>

        <h3>5.2 Testing Strategy</h3>
        <p>Test your integration systematically:</p>
        <ul>
          <li>
            <strong>OAuth Flow:</strong> Ensure authentication works end-to-end
          </li>
          <li>
            <strong>MCP Tool Discovery:</strong> Verify you can retrieve
            available tools
          </li>
          <li><strong>Tool Execution:</strong> Test basic MCP tool calls</li>
          <li>
            <strong>AI Interpretation:</strong> Validate that AI responses make
            sense
          </li>
          <li>
            <strong>Error Handling:</strong> Test fallback mechanisms and error
            scenarios
          </li>
        </ul>
      </div>

      <div class="content">
        <h2 id="part6">Part 6: Getting Started</h2>

        <h3>6.1 Basic Workflow</h3>
        <p>Once your system is set up, the basic workflow is:</p>
        <ul>
          <li>User asks a question in natural language</li>
          <li>Your AI analyzes the question and selects an MCP tool</li>
          <li>System executes the tool against NetSuite</li>
          <li>
            AI interprets the results and provides a conversational answer
          </li>
        </ul>

        <h3>6.2 Configuration Requirements</h3>
        <p>You'll need to configure:</p>
        <ul>
          <li>
            <strong>NetSuite Credentials:</strong> Account ID and Client ID from
            your integration record
          </li>
          <li>
            <strong>AI Service:</strong> API keys and configuration for your
            chosen AI provider
          </li>
          <li>
            <strong>Environment Settings:</strong> URLs, ports, and other
            configuration values
          </li>
        </ul>

        <h3>6.3 Validation Steps</h3>
        <p>Verify your integration works by:</p>
        <ul>
          <li>Testing the OAuth authentication flow</li>
          <li>Discovering available MCP tools</li>
          <li>Executing a simple query (like counting customers)</li>
          <li>Ensuring AI interpretation provides meaningful answers</li>
        </ul>
      </div>

      <div class="content">
        <h2 id="part7">Part 7: Troubleshooting</h2>

        <h3>7.1 Common Issues</h3>

        <h4>"MCP tools not available"</h4>
        <ul>
          <li>Ensure the MCP Tools SuiteApp is installed</li>
          <li>Check that your user has the custom MCP role assigned</li>
          <li>Verify the OAuth scope includes "mcp"</li>
        </ul>

        <h4>"Authentication failed"</h4>
        <ul>
          <li>Check that your Client ID is correct</li>
          <li>
            Ensure the redirect URI matches exactly:
            <code>http://localhost:3000</code>
          </li>
          <li>Verify the integration record is enabled</li>
        </ul>

        <h4>"Gemini API key not configured"</h4>
        <ul>
          <li>Add your Gemini API key to the <code>.env</code> file</li>
          <li>Restart the development server</li>
        </ul>

        <h4>Port conflicts</h4>
        <ul>
          <li>Ensure ports 3000 and 3001 are available</li>
          <li>Check for other running Node.js processes</li>
        </ul>

        <h3>7.2 Debug Logging</h3>
        <p>
          The application includes comprehensive console logging. Check the
          browser console and terminal for:
        </p>
        <ul>
          <li>OAuth flow progress</li>
          <li>MCP tool discovery results</li>
          <li>API request/response details</li>
          <li>AI interpretation steps</li>
        </ul>
      </div>

      <div class="content">
        <h2 id="part8">Part 8: Production Considerations</h2>

        <h3>8.1 Security</h3>
        <ul>
          <li>Store sensitive configuration in environment variables</li>
          <li>Implement proper session management</li>
          <li>Use HTTPS in production</li>
          <li>Consider implementing rate limiting</li>
        </ul>

        <h3>8.2 Deployment</h3>
        <ul>
          <li>Build the React app: <code>npm run build</code></li>
          <li>Deploy the backend to a cloud service (Heroku, AWS, etc.)</li>
          <li>Update redirect URIs for production domains</li>
          <li>Configure CORS for production origins</li>
        </ul>

        <h3>8.3 Monitoring</h3>
        <ul>
          <li>Implement logging for production environments</li>
          <li>Monitor API usage and performance</li>
          <li>Set up error tracking and alerting</li>
        </ul>
      </div>

      <div class="conclusion">
        <h3>🎯 Key Takeaway</h3>
        <p>
          <strong
            >Yes, you CAN connect your AI assistant to NetSuite using
            MCP!</strong
          >
          While it may have some bugs and challenges (as any integration does),
          the core architecture works and provides a powerful way to give users
          conversational access to their NetSuite data.
        </p>

        <div class="highlight-box">
          <h4>🚀 What We've Proven</h4>
          <p>Using Gemini AI, we successfully created a system that:</p>
          <ol>
            <li>Understands natural language questions about NetSuite data</li>
            <li>Automatically selects and executes the right MCP tools</li>
            <li>Converts raw NetSuite responses into conversational answers</li>
            <li>
              Provides a user-friendly interface for business intelligence
            </li>
          </ol>
        </div>

        <div class="feature-grid" style="margin-top: 30px">
          <div class="feature-card">
            <h4>🔒 Secure</h4>
            <p>OAuth 2.0 PKCE authentication with NetSuite</p>
          </div>
          <div class="feature-card">
            <h4>🧠 Intelligent</h4>
            <p>AI-powered query analysis and response generation</p>
          </div>
          <div class="feature-card">
            <h4>⚡ Real-time</h4>
            <p>Live data access through NetSuite's MCP server</p>
          </div>
          <div class="feature-card">
            <h4>🔧 Extensible</h4>
            <p>Easy to add new MCP tools and capabilities</p>
          </div>
        </div>

        <p style="margin-top: 30px; font-size: 1.1rem">
          The integration works, it's powerful, and it opens up new
          possibilities for how users interact with their NetSuite data. While
          there are challenges to overcome, the foundation is solid and the
          potential is enormous.
        </p>
      </div>
    </div>
  </body>
</html>
